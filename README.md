# üåü LangRank

[![CI](https://github.com/hexqnt/langrank/actions/workflows/ci.yml/badge.svg)](https://github.com/hexqnt/langrank/actions/workflows/ci.yml)

LangRank ‚Äî —É—Ç–∏–ª–∏—Ç–∞ –Ω–∞ Rust, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç —Å–≤–µ–∂–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (TIOBE, PYPL, Languish), –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö —Å –¥–∞–Ω–Ω—ã–º–∏ Benchmarks Game –∏ TechEmpower Framework Benchmarks, –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Ç–æ–¥—É –®—É–ª—å—Ü–µ.

![LangRank poster](img/poster.gif)

<sup>üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞</sup>

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üìö –û –ø—Ä–æ–µ–∫—Ç–µ](#-–æ-–ø—Ä–æ–µ–∫—Ç–µ)
- [üõ†Ô∏è –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#Ô∏è-—Å–±–æ—Ä–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
- [üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–≥—Ä—É–∑–æ–∫](#-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-–≤—ã–≥—Ä—É–∑–æ–∫)
- [üñºÔ∏è HTML-–æ—Ç—á—ë—Ç](#Ô∏è-html-–æ—Ç—á—ë—Ç)
- [üßÆ –ê–ª–≥–æ—Ä–∏—Ç–º –®—É–ª—å—Ü–µ](#-–∞–ª–≥–æ—Ä–∏—Ç–º-—à—É–ª—å—Ü–µ)
- [ü§ñ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥](#-–∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ-–∫–æ–º–∞–Ω–¥)
- [üåê –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#-–∏—Å—Ç–æ—á–Ω–∏–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
- [üß± –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞](#-—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è-—Å–±–æ—Ä–∫–∞)

## üìö –û –ø—Ä–æ–µ–∫—Ç–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –±—ã—Å—Ç—Ä—É—é —Å–≤–µ—Ä–∫—É —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–æ–≤. –û–Ω–æ:

1. –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç —Å–≤–æ–¥–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ [TIOBE](https://www.tiobe.com/tiobe-index/), [PYPL](https://pypl.github.io/PYPL.html) –∏ [Languish](https://tjpalmer.github.io/languish/).
2. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è —è–∑—ã–∫–æ–≤ –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏.
3. –°–∫–∞—á–∏–≤–∞–µ—Ç CSV Benchmarks Game –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å (–≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ —Å—Ä–µ–¥–Ω–µ–µ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –ª—É—á—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –Ω–∞ –∑–∞–¥–∞—á–∞—Ö).
4. –°—á–∏—Ç—ã–≤–∞–µ—Ç TechEmpower Framework Benchmarks –∏ –±–µ—Ä—ë—Ç –ª—É—á—à–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —è–∑—ã–∫–∞ –ø–æ –∫–æ–º–ø–æ–∑–∏—Ç–Ω–æ–º—É score.
5. –°—Ç—Ä–æ–∏—Ç –∏—Ç–æ–≥–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –ø–æ –º–µ—Ç–æ–¥—É –®—É–ª—å—Ü–µ, —É—á–∏—Ç—ã–≤–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

## üõ†Ô∏è –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ —Å –≤—ã–≤–æ–¥–æ–º —Ç–æ–ø-10 –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cargo run --release

# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ —Å –ø–æ–ª–Ω—ã–º Schulze-—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º
cargo run --release -- --full-output
```

## üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–≥—Ä—É–∑–æ–∫

–ö–∞–∂–¥—ã–π —Ñ–ª–∞–≥ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –±–µ–∑ –ø—É—Ç–∏ ‚Äî –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –î–æ–±–∞–≤—å—Ç–µ `--archive-csv`, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å CSV –≤ `.gz` (—É–¥–æ–±–Ω–æ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ).

```bash
# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏ Schulze-—Ç–∞–±–ª–∏—Ü—É
cargo run --release -- \
  --save-rankings data/output/rankings.csv \
  --save-schulze

# –°–æ—Ö—Ä–∞–Ω—è–µ–º CSV Benchmarks Game –≤ –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—É—Ç—å
cargo run --release -- --save-benchmarks data/raw/alldata.csv

# –°–æ—Ö—Ä–∞–Ω—è–µ–º CSV –≤ gzip-–∞—Ä—Ö–∏–≤—ã
cargo run --release -- --save-rankings --save-schulze --archive-csv
```

## üñºÔ∏è HTML-–æ—Ç—á—ë—Ç

LangRank —É–º–µ–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—É—é HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∏—Ç–æ–≥–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ–π, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Ä–∞–∑–¥–∞–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ nginx.
–ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω `--full-output`, –≤ –æ—Ç—á—ë—Ç –ø–æ–ø–∞–¥—ë—Ç –ø–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∏–Ω–∞—á–µ ‚Äî —Ç–æ–ø‚Äë10.
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `--archive-csv` —Å—Å—ã–ª–∫–∏ –≤ HTML –±—É–¥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ `.gz`.
–ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é HTML –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —Ñ–ª–∞–≥–æ–º `--minify-html`.

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML-–æ—Ç—á—ë—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é data/output/report.html)
cargo run --release -- --save-html

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML-–æ—Ç—á—ë—Ç –≤ –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—É—Ç—å
cargo run --release -- --save-html report.html

# –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤ HTML
cargo run --release -- --save-html report.html --full-output

# –ú–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å HTML
cargo run --release -- --save-html report.html --minify-html
```

## üßÆ –ê–ª–≥–æ—Ä–∏—Ç–º –®—É–ª—å—Ü–µ

LangRank —Å—Ç—Ä–æ–∏—Ç —á–µ—Ç—ã—Ä–µ ¬´–±—é–ª–ª–µ—Ç–µ–Ω—è¬ª –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π: –ø–æ –ø–æ–∑–∏—Ü–∏—è–º –≤ TIOBE, PYPL, Languish –∏ –ø–æ –∏—Ç–æ–≥–æ–≤–æ–º—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª—é Perf (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ Benchmarks Game –∏ TechEmpower). –ó–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –Ω–∞–¥ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏ –≤ –º–∞—Ç—Ä–∏—Ü–µ —Å–∏–ª—å–Ω–µ–π—à–∏—Ö –ø—É—Ç–µ–π –®—É–ª—å—Ü–µ. –ü—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—á—ë—Ç: –¥–æ–ª–∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ + Perf.

BG —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ –¥–∞–Ω–Ω—ã–º Benchmarks Game —Ç–∞–∫:

$$
\mathrm{ratio}_t = \frac{\mathrm{best\_time}_t}{\mathrm{lang\_time}_t}
$$

$$
\mathrm{BG} = \exp\left(\frac{1}{N}\sum_{t=1}^{N} \ln(\mathrm{ratio}_t)\right)
$$

–≥–¥–µ $\mathrm{best\_time}_t$ ‚Äî –ª—É—á—à–µ–µ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ) –≤—Ä–µ–º—è —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤ –Ω–∞ –∑–∞–¥–∞—á–µ $t$,
$\mathrm{lang\_time}_t$ ‚Äî –≤—Ä–µ–º—è —è–∑—ã–∫–∞ –Ω–∞ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ, $N$ ‚Äî —á–∏—Å–ª–æ –∑–∞–¥–∞—á —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
–ó–Ω–∞—á–µ–Ω–∏–µ –ª–µ–∂–∏—Ç –≤ (0, 1]: —á–µ–º –±–ª–∏–∂–µ –∫ 1, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

TechEmpower (TE) —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–∞–∫:

1. –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–π completed run —Å `tfb-status.techempower.com`.
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ —Å—á–∏—Ç–∞–µ–º –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (RPS) –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–µ—Å—Ç—É:
   JSON, Plaintext, Single Query (db), Multi Query (query), Fortunes (fortune), Updates (update).
3. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º RPS –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–µ—Å—Ç—É, –¥–µ–ª—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π RPS —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –≤ —ç—Ç–æ–º —Ç–µ—Å—Ç–µ.
4. –°—á–∏—Ç–∞–µ–º –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π score —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ —Å –≤–µ—Å–∞–º–∏ (TPR bias coefficients):
   JSON=1.0, Plaintext=0.75, db=0.75, query=0.75, fortune=1.5, update=1.25.
5. –î–ª—è —è–∑—ã–∫–∞ –±–µ—Ä—ë–º –ª—É—á—à–∏–π (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π) score —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –µ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤.

–§–æ—Ä–º—É–ª—ã:

$$
\mathrm{RPS}_{f,t} = \frac{\mathrm{total\_requests}_{f,t}}{(\mathrm{end}_t - \mathrm{start}_t)/1000}
$$

$$
\mathrm{norm}_{f,t} = \frac{\mathrm{RPS}_{f,t}}{\max\_f \mathrm{RPS}_{f,t}}
$$

$$
\mathrm{TE\_framework}_f = \sum_{t \in T} w_t \cdot \mathrm{norm}_{f,t}
$$

$$
\mathrm{TE\_language} = \max_{f \in \mathrm{frameworks(language)}} \mathrm{TE\_framework}_f
$$

–ï—Å–ª–∏ —É —è–∑—ã–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö TE, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.

Perf ‚Äî –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ BG –∏ TE. TE –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É 0..1, –ø–æ—Å–ª–µ —á–µ–≥–æ –±–µ—Ä—ë—Ç—Å—è —Å—Ä–µ–¥–Ω–µ–µ. –ï—Å–ª–∏ —É —è–∑—ã–∫–∞ –Ω–µ—Ç BG –∏–ª–∏ TE, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è 0 (–≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –¥–ª—è BG/TE –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ¬´-¬ª). –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ BG, –Ω–∏ TE, Perf —Ç–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ ¬´-¬ª.

$$
\mathrm{TE\_norm} = \frac{\mathrm{TE}}{6}
$$

$$
\mathrm{Perf} = \frac{\mathrm{BG} + \mathrm{TE\_norm}}{2}
$$

 

## ü§ñ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥

–£—Ç–∏–ª–∏—Ç–∞ —É–º–µ–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –æ–±–æ–ª–æ—á–µ–∫:

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è Bash
cargo run -- completions bash --install

# –í—ã–≤–µ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è fish –≤ stdout
cargo run -- completions fish
```

## üåê –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

- üîµ TIOBE Index ‚Äî <https://www.tiobe.com/tiobe-index/>
- üî∂ PYPL Popularity Index ‚Äî <https://pypl.github.io/PYPL.html>
- üü¢ Languish (Programming Language Trends) ‚Äî <https://tjpalmer.github.io/languish/>
- üü• Benchmarks Game ‚Äî <https://salsa.debian.org/benchmarksgame-team/benchmarksgame/-/raw/master/public/data/alldata.csv>
- üü£ TechEmpower Framework Benchmarks ‚Äî <https://www.techempower.com/benchmarks/>

## üß± –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞

–î–ª—è —Å–±–æ—Ä–∫–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –ø–æ–¥ Linux/musl –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
./build_musl.sh
```

–û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `clux/muslrust:nightly` –∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–∏–∑–Ω—É—é –≤–µ—Ä—Å–∏—é.
